//! Speech KITT
//! version : 0.3.0
//! author  : Tal Ater @TalAter
//! license : MIT
//! https://github.com/TalAter/SpeechKITT
(function(t){"use strict";var e,n,i,o,s,c,a=this,r=0,l=!1,d="Activate Voice Control",u="What can I help you with?",g=[],m=[],f=!1,h=function(){return c!==t},k=function(){o&&h()&&(s?s.href=o:((s=document.createElement("link")).rel="stylesheet",s.href=o,s.id="skitt-style-sheet",document.body.appendChild(s)))},p=function(){if(h()){var t=document.getElementById("skitt-listening-text__samples");if(g.length){if(!t){var e=document.getElementById("skitt-listening-text__instructions");(t=document.createElement("span")).id="skitt-listening-text__samples",e.parentNode.insertBefore(t,e.nextSibling)}t.innerText=g.join(". ")+".",c.classList.add("skitt-ui--sample-commands-shown")}else t&&t.parentNode.removeChild(t),c.classList.remove("skitt-ui--sample-commands-shown")}},b=function(){if(h()){var t=document.getElementById("skitt-listening-text__recognized-sentence"),e=a.SpeechKITT.getLastRecognizedSentence();if(e&&f){if(!t){var n=document.getElementById("skitt-listening-text__samples")||document.getElementById("skitt-listening-text__instructions");(t=document.createElement("span")).id="skitt-listening-text__recognized-sentence",n.parentNode.insertBefore(t,n.nextSibling)}t.innerText=e,c.classList.add("skitt-ui--recognized-sentence-shown")}else t&&t.parentNode.removeChild(t),c.classList.remove("skitt-ui--recognized-sentence-shown")}},y=function(){(c=document.createElement("div")).id="skitt-ui",c.innerHTML='<a id="skitt-toggle-button">&nbsp;</a><label for="skitt-toggle-button" id="skitt-toggle-button__label">'+d+'</label><div id="skitt-listening-box"><div id="skitt-listening-text"><span id="skitt-listening-text__instructions">'+u+"</span></div></div>",c.style.display="none",document.body.appendChild(c),p(),k(),document.getElementById("skitt-toggle-button").addEventListener("click",function(){a.SpeechKITT.toggleRecognition()})},T=function(){h()&&(c.classList.remove("skitt-ui--not-listening"),c.classList.add("skitt-ui--listening"))},v=function(){h()&&(c.classList.add("skitt-ui--not-listening"),c.classList.remove("skitt-ui--listening"))},x=function(){l||(l=!0,T())},_=function(){l&&(l=!1,v())},S=function(t,e){h()&&(document.getElementById(e).innerHTML=t)},w=function(t){Array.isArray(t)&&(t=t[0]),a.SpeechKITT.setRecognizedSentence(t)},E=function(){var t=new Date;t.setTime(t.getTime()+6e4*r),document.cookie="skittremember=1; expires="+t.toUTCString()+"; path=/"},L=function(){document.cookie="skittremember=1; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/"},C=function(){return-1!==document.cookie.indexOf("skittremember")},I=function(t,e){if("function"!=typeof t)throw new TypeError(e)};a.SpeechKITT={setStartCommand:function(t,e){t=a[t]||t,I(t,"invalid callback function"),n={callback:t,context:e=e||this}},setAbortCommand:function(t,e){t=a[t]||t,I(t,"invalid callback function"),i={callback:t,context:e=e||this}},startRecognition:function(){if(!n)throw new TypeError("cannot start recognition. Start command not defined");r&&E(),n.callback.apply(n.context),x()},abortRecognition:function(){if(!i)throw new TypeError("cannot abort recognition. Abort command not defined");L(),i.callback.apply(i.context),_()},toggleRecognition:function(){l?this.abortRecognition():this.startRecognition()},onStart:function(){a.clearTimeout(e),x()},onEnd:function(){e=setTimeout(_,100)},setStylesheet:function(t){o=t,k()},render:function(){h()||y(),C()&&!this.isListening()&&this.startRecognition(),this.isListening()?T():v()},vroom:function(){this.render()},hide:function(){if(!h())throw new TypeError("cannot hide interface. Must be rendered first");c.classList.add("skitt-ui--hidden")},show:function(){if(!h())throw new TypeError("cannot show interface. Must be rendered first");c.classList.remove("skitt-ui--hidden")},isListening:function(){return l},setToggleLabelText:function(t){d=t,S(t,"skitt-toggle-button__label")},setInstructionsText:function(t){u=t,S(t,"skitt-listening-text__instructions")},setSampleCommands:function(t){Array.isArray(t)||(t=[]),g=t,p()},rememberStatus:function(t){if("number"!=typeof t||t<0)throw new TypeError("rememberStatus() only accepts positive integers");r=t},getLastRecognizedSentence:function(){return 0===m.length?t:m[m.length-1]},setRecognizedSentence:function(t){"string"==typeof t&&(m.push(t),b())},displayRecognizedSentence:function(t){f=!(arguments.length>0)||!!t,b()},annyang:function(){this.setStartCommand(annyang.start),this.setAbortCommand(annyang.abort),annyang.addCallback("start",this.onStart),annyang.addCallback("end",this.onEnd),annyang.addCallback("resultMatch",w),annyang.addCallback("resultNoMatch",w)}}}).call(this);